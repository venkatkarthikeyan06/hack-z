<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio-Based Listening Training</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: #f4f6f9;
            font-family: 'Arial', sans-serif;
        }
        .container {
            max-width: 800px;
            background-color: #fff;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
            margin-top: 50px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .container:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }
        .heading {
            font-size: 2.4rem;
            font-weight: 700;
            text-align: center;
            color: #007bff;
            margin-bottom: 25px;
        }
        .audio-player {
            text-align: center;
            margin-bottom: 30px;
        }
        .question-section {
            display: none;
        }
        .btn-primary {
            background: linear-gradient(135deg, #007bff, #0056b3);
            border: none;
            font-size: 1.1rem;
            padding: 12px 30px;
            border-radius: 30px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #0056b3, #003366);
        }
        .score {
            font-size: 1.2rem;
            font-weight: bold;
            color: #28a745;
            margin-top: 15px;
        }
        .question {
            font-size: 1.2rem;
            font-weight: 600;
        }
        .feedback {
            font-size: 1.1rem;
            font-weight: 500;
            text-align: center;
        }
    </style>
</head>
<body>

<div class="container">
    <h2 class="heading">Audio-Based Listening Training</h2>

    <!-- Audio Player Section -->
    <div class="audio-player">
        <audio id="audio" controls autoplay>
            <source id="audio-source" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mp3">
            Your browser does not support the audio element.
        </audio>
        <button id="next-button" class="btn btn-primary w-100 mt-3" style="display:none;">Next to Questions</button>
    </div>

    <!-- Question Section (Initially Hidden) -->
    <div class="question-section">
        <p id="question" class="question"></p>
        <div id="mcq-options"></div>
        <button id="submit-answer" class="btn btn-primary w-100 mt-3">Submit Answer</button>
        <button id="next-question" class="btn btn-primary w-100 mt-3" style="display:none;">Next</button>
        <p id="feedback" class="feedback"></p>
        <p id="score" class="score">Score: 0</p>
    </div>
</div>

<script>
    // Audio and Question Handling
    const audio = document.getElementById('audio');
    const audioSource = document.getElementById('audio-source');
    const questionSection = document.querySelector('.question-section');
    const submitButton = document.getElementById('submit-answer');
    const nextButton = document.getElementById('next-question');
    const feedbackElement = document.getElementById('feedback');
    const scoreElement = document.getElementById('score');
    const mcqOptionsElement = document.getElementById('mcq-options');
    const nextAudioButton = document.getElementById('next-button');

    let score = 0;
    let currentLevel = 0; // Track the current level
    let totalQuestions = 0; // Track total questions for the current level
    let correctAnswers = 0; // Track correct answers for the current level

    // Example audio content and questions for multiple levels
    const levels = [
        {
            audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
            questions: [
                { 
                    question: "What is the main topic of the audio?", 
                    options: ["Protecting our environment", "Reducing waste", "Sustainability"], 
                    answer: "Protecting our environment" 
                },
                { 
                    question: "What can we do to reduce pollution?", 
                    options: ["Reduce waste", "Use plastic", "Increase carbon emissions"], 
                    answer: "Reduce waste" 
                },
                { 
                    question: "Why is sustainability important?", 
                    options: ["To protect the planet", "To increase waste", "To use more resources"], 
                    answer: "To protect the planet" 
                }
            ]
        }
        // Add more levels as needed
    ];

    // Show Next Button after Audio Ends
    audio.addEventListener('ended', () => {
        nextAudioButton.style.display = 'block';
    });

    // Load Next Level (after passing)
    function loadNextLevel() {
        const level = levels[currentLevel];

        // Update audio source
        audioSource.src = level.audioUrl;
        audio.load(); // Reload audio

        // Update question text and display question section
        questionSection.style.display = 'none';
        feedbackElement.textContent = "";
        scoreElement.textContent = `Score: ${score}`;
        mcqOptionsElement.innerHTML = ""; // Clear previous options
        correctAnswers = 0; // Reset correct answers for the new level
        totalQuestions = level.questions.length; // Set total questions for the current level

        // Set questions and options
        level.questions.forEach((q, index) => {
            const questionDiv = document.createElement('div');
            questionDiv.innerHTML = `<strong>${q.question}</strong>`;
            q.options.forEach(option => {
                questionDiv.innerHTML += `  
                    <div>
                        <input type="radio" name="mcq" value="${option}" id="option${index}${option}">
                        <label for="option${index}${option}">${option}</label>
                    </div>
                `;
            });
            mcqOptionsElement.appendChild(questionDiv);
        });

        questionSection.style.display = 'block';
    }

    // Check Answer
    function checkAnswer() {
        const userAnswer = document.querySelector('input[name="mcq"]:checked');
        if (userAnswer) {
            const selectedAnswer = userAnswer.value;
            const correctAnswer = levels[currentLevel].questions[correctAnswers].answer;

            if (selectedAnswer === correctAnswer) {
                feedbackElement.textContent = "Correct! Well done!";
                score += 10; // Add score for correct answer
                correctAnswers++; // Increment correct answers
            } else {
                feedbackElement.textContent = `Incorrect. The correct answer is: "${correctAnswer}"`;
            }

            scoreElement.textContent = `Score: ${score}`;
            submitButton.disabled = true;

            nextButton.style.display = 'block'; // Show Next button after answer submission
        } else {
            feedbackElement.textContent = "Please select an answer.";
        }
    }

    // Handle Submit Button Click
    submitButton.addEventListener('click', checkAnswer);

    // Handle Next Button Click to load next question or level
    nextButton.addEventListener('click', () => {
        if (correctAnswers / totalQuestions >= 0.5) { // Check if score is at least 50%
            currentLevel++;
            if (currentLevel < levels.length) {
                loadNextLevel();
            } else {
                feedbackElement.textContent = `Congratulations! You've completed all levels. Your final score is: ${score}`;
                questionSection.style.display = 'none'; // Hide question section
                nextAudioButton.style.display = 'none'; // Hide next button
            }
        } else {
            feedbackElement.textContent = "You need at least 50% correct answers to proceed to the next level.";
        }
    });

    // Handle Next Audio Button Click
    nextAudioButton.addEventListener('click', () => {
        questionSection.style.display = 'none'; // Hide question section
        nextAudioButton.style.display = 'none'; // Hide next button
        loadNextLevel(); // Load the next level
    });

    // Initialize the first level
    loadNextLevel();
</script>

</body>
</html>